const shayariDB = {
  "Love": [
    "तेरे बिना अधूरी है ज़िंदगी मेरी...",
    "तू है तो सब कुछ है, वरना कुछ भी नहीं...",
    "दिल ने जिसे चाहा है, वो तू ही तो है...",
    "तेरी हँसी मेरी जान है...",
    "तेरे साथ हर पल हसीन है..."
  ],
  "Birthday": [
    "जन्मदिन की ढेरों शुभकामनाएं...",
    "आपका दिन खुशियों से भरा हो...",
    "जन्मदिन मुबारक हो मेरी जान...",
    "आपका हर ख्वाब पूरा हो...",
    "खुश रहो हमेशा, जन्मदिन की बधाई!"
  ],
  "Friendship": [
    "सच्चा दोस्त वही जो मुश्किल में काम आए...",
    "दिल से निभाई जाती है दोस्ती...",
    "दोस्ती नाम है विश्वास का...",
    "यारी वही जो हर मोड़ पर साथ दे...",
    "सच्ची दोस्ती दिल से होती है..."
  ]
};

window.onload = () => {
  const categorySelect = document.getElementById("categorySelect");
  if (!categorySelect) return;
  for (let category in shayariDB) {
    const opt = document.createElement("option");
    opt.value = category;
    opt.textContent = category;
    categorySelect.appendChild(opt);
  }
};

function updateShayariOptions() {
  const category = document.getElementById("categorySelect")?.value;
  const shayariSelect = document.getElementById("shayariSelect");
  if (!shayariSelect || !category) return;

  shayariSelect.innerHTML = '<option value="">-- शायरी चुनें --</option>';

  if (shayariDB[category]) {
    shayariDB[category].forEach(shayari => {
      const opt = document.createElement("option");
      opt.value = shayari;
      opt.textContent = shayari;
      shayariSelect.appendChild(opt);
    });
  }
}

function fillShayari() {
  const selected = document.getElementById("shayariSelect")?.value;
  const shayariText = document.getElementById("shayariText");
  if (shayariText) {
    shayariText.value = selected;
  }
}

function generateImage() {
  const file = document.getElementById("imageUpload")?.files[0];
  const color = document.getElementById("colorPicker")?.value;
  const fontSize = document.getElementById("fontSize")?.value;
  const position = document.getElementById("positionSelect")?.value;
  const text = document.getElementById("shayariText")?.value;

  if (!file) return alert("कृपया एक फोटो चुनें!");

  const reader = new FileReader();
  reader.onload = (e) => {
    const img = new Image();
    img.onload = () => {
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      canvas.width = img.width;
      canvas.height = img.height;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0);

      ctx.font = `${fontSize}px 'Noto Sans Devanagari', sans-serif`;
      ctx.fillStyle = color;
      ctx.strokeStyle = "black";
      ctx.lineWidth = 2;
      ctx.textAlign = "center";

      const x = canvas.width / 2;
      const y = position === "top" ? 80 : canvas.height - 60;

      ctx.strokeText(text, x, y);
      ctx.fillText(text, x, y);

      const output = document.getElementById("outputImage");
      output.src = canvas.toDataURL("image/png");
      output.style.display = "block";
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

function downloadImage() {
  const output = document.getElementById("outputImage");
  if (!output?.src) return alert("पहले इमेज बनाएं!");

  const link = document.createElement("a");
  link.href = output.src;
  link.download = "shayari-photo.png";
  link.click();
}

function shareWhatsApp() {
  const canvas = document.getElementById("canvas");
  canvas.toBlob(blob => {
    const file = new File([blob], "shayari.png", { type: "image/png" });

    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      navigator.share({
        title: "Shayari Image",
        text: "मैंने Shayari फोटो बनाई है:\nhttps://myshaadistyle.blogspot.com",
        files: [file]
      });
    } else {
      const text = encodeURIComponent("मैंने Shayari फोटो बनाई है, आप भी बनाओ:\nhttps://myshaadistyle.blogspot.com");
      const link = `https://wa.me/?text=${text}`;
      window.open(link, "_blank");
    }
  });
  }
